stages:
- build
- sonar
- pre-release
- release

workflow:
    rules:
        - if: $CI_COMMIT_BRANCH && $CI_OPEN_MERGE_REQUESTS && $CI_PIPELINE_SOURCE == "push"
          when: never
        - when: always

default:
  tags:
  - frontend
  before_script:
  - nvm install 18


build:
  stage: build
  script:
  - bash senior-ci/frontend/npm/bibliotecas/ci.sh -b $CI_PROJECT_NAME $CI_PROJECT_ID
    $CI_BUILD_REF $CI_BUILD_REF_NAME
  except:
  - develop
  - master
  - tags

scanner:
    stage: sonar
    script:
        - bash senior-ci/ci/ci.sh -x
    only:
        - branches
        - merge_requests

releaseSnapshot:
    stage: pre-release
    when: manual
    script:
        - bash senior-ci/frontend/npm/bibliotecas/ci.sh -s $CI_COMMIT_REF_SLUG
    except:
        - master
        - tags

releasePatch:
    stage: release
    when: manual
    script:
        - bash senior-ci/ci/ci.sh -r patch
    only:
        - develop

releaseMinor:
    stage: release
    when: manual
    script:
        - bash senior-ci/ci/ci.sh -r minor
    only:
        - develop

releaseMajor:
    stage: release
    when: manual
    script:
        - bash senior-ci/ci/ci.sh -r major
    only:
        - develop

package:
    stage: release
    script:
        - bash senior-ci/frontend/npm/bibliotecas/ci.sh -p
    only:
        - tags
