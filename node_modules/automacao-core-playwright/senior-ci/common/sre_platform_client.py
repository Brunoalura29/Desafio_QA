import sys

import requests

sys.path.append("./senior-ci")


from common import get_env_variable


class SrePlatformClient(object):
    """Creates a client to make calls to Sre Platform"""

    def __init__(self):
        self.base_url = get_env_variable("SRE_PLATFORM_URL")
        data = {
            "username": get_env_variable("SRE_PLATFORM_USERNAME"),
            "password": get_env_variable("SRE_PLATFORM_PASSWORD"),
        }
        response = requests.post(
            url=f"{self.base_url}auth/login", json=data, timeout=60
        )

        head = {"Authorization": f"Bearer {response.json()['access_token']}"}

        self.session = requests.Session()
        self.session.headers = head

    def make_post_call(self, path, data):
        response = self.session.post(
            url=f"{self.base_url}{path}", json=data, timeout=60
        )

        return response.json()
