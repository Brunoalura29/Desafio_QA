from common.file_helpers import get_xml_namespace_and_root_element
from src.interface.maven_project import MavenProjectInterface
from src.interface.project_with_docker import ProjectWithDockerInterface


class MavenProjectWithDockerInterface(
    MavenProjectInterface, ProjectWithDockerInterface
):
    def _sources_to_be_scanned(self):
        sources_string = self._get_sonar_sources_from_pom_xml()
        sources_string = sources_string if sources_string else self.ci_project_dir
        return sources_string.split(",")

    def _get_sonar_sources_from_pom_xml(self):
        namespace, root = get_xml_namespace_and_root_element(self.pom_xml)
        property_value = root.find("mvn:properties", namespace)
        sonar_sources = property_value.find("mvn:sonar.sources", namespace)
        if sonar_sources:
            return property_value.find("mvn:sonar.sources", namespace)
        return None
