from colorama import Fore

from common import (
    end_collapsible_section,
    exit_message,
    is_frontend,
    print_message,
    start_collapsible_section,
)
from translations.model import (
    TranslationRepositoryBackend,
    TranslationRepositoryFrontend,
)


class TranslationsValidator(object):
    def __init__(self):
        self.translation_repository = (
            TranslationRepositoryFrontend()
            if is_frontend()
            else TranslationRepositoryBackend()
        )

    def execute(self):
        section_id = start_collapsible_section(
            "Iniciando a validação das traduções...", Fore.CYAN
        )

        print_message(
            "Iniciando verificação de declaração de chave nos arquivos de tradução"
        )

        do_contain_violations = (
            self.translation_repository.check_translation_key_violation()
        )

        if do_contain_violations:
            exit_message(
                "Validação dos arquivos de traduções falhou, por favor cheque as mensagens acima para mais detalhes."
            )

        print_message(
            "Tudo certo! As traduções do projeto estão dentro dos padrões",
            fore_color=Fore.GREEN,
        )

        end_collapsible_section(section_id)
